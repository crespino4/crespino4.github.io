<!DOCTYPE html>
<html>
<head>
    <title>IFrame Page</title>
    <script src="https://sdk-cdn.mypurecloud.com/client-apps/2.6.7/purecloud-client-app-sdk.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script></head>
<body>
    <!-- Buttons container -->
    <div style="margin: 20px;">
        <p>Popup Test</p>
        <button id="buttonPopupSDK">Use SDK</button>
        <button id="buttonPopupJS">Use Native Javascript</button>
    </div>

    <script>
        const popupURL = window.location.origin + window.location.pathname.replace("iframe.html", "popup.html") + window.location.search;

        $(document).ready(function() {
            // Initialize the Client Apps SDK
            const client = new window.purecloud.apps.ClientApp({
                gcHostOriginQueryParam: 'gcHostOrigin',
                gcTargetEnvQueryParam: 'gcTargetEnv'
            });

            // Add localStorage event listener
            window.addEventListener('storage', function(e) {
                if (e.key === 'popuptest') {
                    console.log('popuptest value changed:', e.newValue);
                }
            });            

            // Add window.postMessage event listener
            window.addEventListener('message', function(event) {
                // Verify the origin for security
                if (event.origin !== window.location.origin) {
                    console.log('Received message from untrusted source');
                    return;
                }
                
                // Handle the received message
                console.log('Received message:', event.data);
            });                        

            $('#buttonPopupSDK').click(function() {
                // Handle button click
                console.log('SDK button clicked');
                client.coreUi.openWindow(popupURL);
            });

            $('#buttonPopupJS').click(function() {
                // Handle button click
                console.log('Native JS button clicked');
                window.open(popupURL, "_blank", "width=500,height=500,left=100,top=100")
            });
        });
    </script>
</body>
</html>